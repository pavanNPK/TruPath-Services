<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Jobs Dashboard | TruPath Services</title>

  <meta name="robots" content="noindex, nofollow">

  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../assets/images/core/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="../assets/images/core/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../assets/images/core/favicon-16x16.png">
  <link rel="icon" type="image/svg+xml" href="../assets/images/core/favicon.svg">
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/images/core/apple-touch-icon.png">

  <!-- CSS -->
  <link rel="stylesheet" href="../lib/css/bootstrap.min.css">
  <link rel="stylesheet" href="./admin.css">
  
  <!-- Quill Editor CSS -->
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Sen', sans-serif;
      background-color: #F8F8F8;
      overflow-x: hidden;
    }

    .main-container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 250px;
      background-color: #051C3B;
      color: white;
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      left: 0;
      top: 0;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 0 20px 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 30px;
    }

    .nav-menu {
      list-style: none;
      padding: 0 20px;
    }

    .nav-item {
      margin-bottom: 10px;
    }

    .nav-link {
      display: flex;
      align-items: baseline;
      gap: 12px;
      padding: 12px 15px;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-link.active {
      background-color: #01142E;
    }

    .nav-link:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
      font-size: 25px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logout-link {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .logout-link:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      text-decoration: none;
    }

    /* Main Content */
    .main-content {
      margin-left: 250px;
      flex: 1;
      padding: 30px;
      background-color: #F8F8F8;
      overflow-y: auto;
      height: 100vh;
    }

    .content-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      width: 100%;
    }

    .content-header-left {
      flex: 1;
    }

    .content-header-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 15px;
    }

    .search-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .search-input {
      width: 250px;
      padding: 12px 15px;
      border: 1px solid #DDDDDD;
      border-radius: 25px;
      font-size: 14px;
      outline: none;
    }

    .search-input::placeholder {
      color: #AAAAAA;
    }

    .post-job-btn {
      background-color: #051C3B;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 25px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .post-job-btn:hover {
      background-color: #01142E;
    }

    /* Job Sections */
    .jobs-container {
      display: flex;
      gap: 30px;
      min-height: calc(100vh - 200px);
    }

    .jobs-list {
      flex: 2;
      overflow-y: auto;
    }

    .no-jobs-message {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 300px;
      text-align: center;
    }

    .no-jobs-content h3 {
      color: #666;
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    .no-jobs-content p {
      color: #999;
      font-size: 1rem;
    }

    .job-details {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background: white;
      border-radius: 10px 0 0 10px;
      padding: 25px;
      box-shadow: -5px 0 20px rgba(0, 0, 0, 0.15);
      transition: right 0.3s ease;
      z-index: 1000;
      overflow-y: auto;
    }

    .job-details.show {
      right: 0;
    }

    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
    }

    .jobs-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 40px;
      padding-bottom: 50px;
    }

    .job-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      transition: all 0.3s ease;
    }

    .job-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .job-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .job-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .job-title-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1.2rem;
      color: white;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .job-title-icon.hcc { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .job-title-icon.ai { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .job-title-icon.drg { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
    .job-title-icon.default { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

    .job-company {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .job-location {
      color: #666;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 10px;
    }

    .job-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }

    .job-date {
      color: #999;
      font-size: 0.8rem;
    }


    .closed-badge {
      background-color: #FCE4EC;
      color: #F44336;
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.8rem;
      font-weight: 500;
      margin-left: 8px;
    }

    .job-actions {
      position: absolute;
      top: 15px;
      right: 15px;
      cursor: pointer;
    }

    .dropdown-menu {
      position: absolute;
      top: 25px;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 8px 0;
      min-width: 120px;
      z-index: 1000;
      display: none;
    }

    .dropdown-item {
      padding: 8px 15px;
      color: #333;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
      transition: background-color 0.2s;
    }

    .dropdown-item:hover {
      background-color: #f8f9fa;
      color: #333;
      text-decoration: none;
    }

    /* Job Details Panel */
    .job-details-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .job-details-title {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 600;
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #333;
    }

    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #DDDDDD;
      border-radius: 6px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
    }

    .form-input:focus {
      border-color: #051C3B;
    }

    .form-textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #DDDDDD;
      border-radius: 6px;
      font-size: 14px;
      outline: none;
      resize: vertical;
      min-height: 100px;
      transition: border-color 0.3s;
    }

    .form-textarea:focus {
      border-color: #051C3B;
    }

    .form-select {
      width: 100%;
      padding: 12px;
      border: 1px solid #DDDDDD;
      border-radius: 6px;
      font-size: 14px;
      outline: none;
      background-color: white;
      transition: border-color 0.3s;
    }

    .form-select:focus {
      border-color: #051C3B;
    }

    .quill-editor {
      border: 1px solid #DDDDDD;
      border-radius: 6px;
      min-height: 150px;
    }

    .quill-editor:focus-within {
      border-color: #051C3B;
    }

    .ql-toolbar {
      border-bottom: 1px solid #DDDDDD;
    }

    .ql-container {
      border: none;
      font-size: 14px;
    }

    .responsibilities-list {
      margin-top: 10px;
      padding-left: 20px;
    }

    .responsibilities-list li {
      margin-bottom: 5px;
      color: #666;
      font-size: 0.9rem;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 25px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background-color: #051C3B;
      color: white;
    }

    .btn-primary:hover {
      background-color: #01142E;
    }

    .btn-danger {
      background-color: #F44336;
      color: white;
    }

    .btn-danger:hover {
      background-color: #D32F2F;
    }

    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background-color: #5a6268;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      text-align: center;
      min-width: 300px;
    }

    .modal-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 20px;
    }

    .modal-actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 25px;
    }

    /* Loading and Toast Styles */
    .loading-spinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top: 5px solid #051C3B;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
    }

    .toast {
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 20px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.success {
      border-left: 4px solid #4ecdc4;
    }

    .toast.error {
      border-left: 4px solid #ff6b6b;
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .jobs-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .job-details {
        width: 350px;
        right: -350px;
      }
      
      .search-input {
        width: 200px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      
      .content-header {
        flex-direction: column;
        gap: 20px;
        align-items: center;
        text-align: center;
      }
      
      .content-header-left {
        order: 1;
        width: 100%;
      }
      
      .content-header-right {
        order: 2;
        width: 100%;
        justify-content: center;
      }
      
      .search-container {
        flex-direction: column;
        gap: 15px;
        width: 100%;
        max-width: 400px;
      }
      
      .search-input {
        width: 100%;
      }
      
      .post-job-btn {
        width: 100%;
        justify-content: center;
      }
      
      .jobs-grid {
        grid-template-columns: 1fr;
      }
      
      .job-details {
        width: 100%;
        right: -100%;
      }
    }
  </style>
</head>
<body>
  <div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
  </div>

  <div class="toast-container" id="toastContainer"></div>

  <div class="main-container w-100">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="../assets/images/admin/admin-login-form-inverse.svg" alt="TruPath Logo">
        </div>
      </div>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" class="nav-link active">
            <div class="nav-icon">‚äû</div>
            Jobs
          </a>
        </li>
      </ul>
      
      <a href="#" class="logout-link" onclick="logout()">
        <div class="nav-icon">‚èª</div>
        Log out
      </a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="content-header">
        <div class="content-header-left">
          <h1 class="section-title m-0">All Jobs</h1>
        </div>
        <div class="content-header-right">
          <div class="search-container">
            <input type="text" class="search-input" placeholder="search by name" id="searchInput">
            <button class="post-job-btn" onclick="showPostJobForm()">
              <img src="../assets/images/careers/postJob.svg" alt="Post Job" style="width: 16px; height: 16px;">
              Post A Job
            </button>
          </div>
        </div>
      </div>

      <div class="jobs-container">
        <div class="jobs-list">
          <div class="jobs-grid" id="allJobs">
            <!-- All Jobs will be loaded here -->
          </div>
          <div id="noJobsMessage" class="no-jobs-message" style="display: none;">
            <div class="no-jobs-content">
              <h3>No jobs found</h3>
              <p>There are no jobs matching your search criteria.</p>
            </div>
          </div>
        </div>

        <div class="job-details" id="jobDetailsPanel" style="display: none;">
        <div class="job-details-header">
          <h3 class="job-details-title">Job Details</h3>
          <div style="display: flex; align-items: center; gap: 10px;">
            <button onclick="closeJobDetails()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: #666;">√ó</button>
          </div>
        </div>
          
          <form id="jobDetailsForm">
            <div class="form-group">
              <label class="form-label">Job Title *</label>
              <input type="text" class="form-input" id="jobTitle" placeholder="Enter job title" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Job Description *</label>
              <div id="jobDescriptionEditor" class="quill-editor"></div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Status *</label>
              <select class="form-select" id="jobStatus" required>
                <option value="">Select Status</option>
                <option value="true">Open</option>
                <option value="false">Closed</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">Location *</label>
              <input type="text" class="form-input" id="location" placeholder="Enter job location" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Experience Level *</label>
              <input type="text" class="form-input" id="experienceLevel" placeholder="0 to 10 years" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">Salary *</label>
              <input type="text" class="form-input" id="salary" placeholder="e.g., 25000/- per annum" required>
            </div>
            
            <div class="action-buttons">
              <button type="button" class="btn btn-primary" id="primaryActionBtn" onclick="handlePrimaryAction()">Update Changes</button>
              <button type="button" class="btn btn-danger" id="secondaryActionBtn" onclick="handleSecondaryAction()">Delete Job</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal" id="deleteModal">
    <div class="modal-content w-auto">
      <h3 class="modal-title">Are you sure you want to delete job?</h3>
      <div class="modal-actions">
        <button class="btn btn-danger d-flex align-items-center gap-2" onclick="confirmDelete()">
          <span class="nav-icon">üóëÔ∏è</span>
          <span>Delete Job</span>
        </button>
        <button class="btn btn-primary d-flex align-items-center gap-2" onclick="cancelDelete()">
          <span class="nav-icon">‚ùå</span>
          <span>Cancel</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Quill Editor JS -->
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  
  <script>
    // Base URL
    const API_BASE_URL = 'http://localhost:3000';
    
    // Initialize Quill Editor
    let quillEditor;
    
    // Sample job data
    const sampleJobs = [
      {
        id: 1,
        title: 'HCC Medical Coder (Risk Adjustment)',
        company: 'Join Our TPS Team!',
        location: 'Hyderabad, TG',
        date: '6 Days Ago',
        status: 'active',
        description: 'We\'re hiring a Junior AR Caller who is motivated, detail-oriented, and ready to grow in the US Healthcare billing domain.',
        salary: '25000/- per month',
        experience: 'Senior level',
        logo: 'hcc.svg'
      },
      {
        id: 2,
        title: 'AI Medical Coder',
        company: 'Join Our TPS Team!',
        location: 'Hyderabad, TG',
        date: '6 Days Ago',
        status: 'active',
        description: 'We\'re hiring a Junior AR Caller who is motivated, detail-oriented, and ready to grow in the US Healthcare billing domain.',
        salary: '25000/- per month',
        experience: 'Senior level',
        logo: 'ai.svg'
      },
      {
        id: 3,
        title: 'DRG Medical Coder',
        company: 'Join Our TPS Team!',
        location: 'Hyderabad, TG',
        date: '6 Days Ago',
        status: 'closed',
        description: 'We\'re hiring a Junior AR Caller who is motivated, detail-oriented, and ready to grow in the US Healthcare billing domain.',
        salary: '25000/- per month',
        experience: 'Senior level',
        logo: 'drg.svg'
      },
      {
        id: 4,
        title: 'HCC Medical Coder (Risk Adjustment)',
        company: 'Join Our TPS Team!',
        location: 'Hyderabad, TG',
        date: '6 Days Ago',
        status: 'closed',
        description: 'We\'re hiring a Junior AR Caller who is motivated, detail-oriented, and ready to grow in the US Healthcare billing domain.',
        salary: '25000/- per month',
        experience: 'Senior level',
        logo: 'hcc.svg'
      },
      {
        id: 5,
        title: 'AI Medical Coder',
        company: 'Join Our TPS Team!',
        location: 'Hyderabad, TG',
        date: '6 Days Ago',
        status: 'active',
        description: 'We\'re hiring a Junior AR Caller who is motivated, detail-oriented, and ready to grow in the US Healthcare billing domain.',
        salary: '25000/- per month',
        experience: 'Senior level',
        logo: 'ai.svg'
      },
      {
        id: 6,
        title: 'DRG Medical Coder',
        company: 'Join Our TPS Team!',
        location: 'Hyderabad, TG',
        date: '6 Days Ago',
        status: 'active',
        description: 'We\'re hiring a Junior AR Caller who is motivated, detail-oriented, and ready to grow in the US Healthcare billing domain.',
        salary: '25000/- per month',
        experience: 'Senior level',
        logo: 'drg.svg'
      }
    ];

    let selectedJobId = null;

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      checkAuthentication();
      loadJobs();
      setupEventListeners();
      initializeQuillEditor();
    });

    // Check if user is authenticated
    function checkAuthentication() {
      const token = localStorage.getItem('authToken');
      
      if (!token) {
        showToast('Please login to access this page', 'error');
        setTimeout(() => {
          window.location.href = './login.html';
        }, 2000);
        return;
      }

      // For demo purposes, skip token verification
      loadJobs();
    }

    // Setup event listeners
    function setupEventListeners() {
      // Search functionality
      document.getElementById('searchInput').addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        filterJobs(searchTerm);
      });

      // Close dropdowns when clicking outside
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.job-actions')) {
          closeAllDropdowns();
        }
        // Only close job details if clicking outside the panel and not on action buttons
        if (!e.target.closest('.job-details') && 
            !e.target.closest('.post-job-btn') && 
            !e.target.closest('.dropdown-item') &&
            !e.target.closest('.job-actions')) {
          closeJobDetails();
        }
      });
    }

    // Load jobs
    function loadJobs() {
      loadAllJobs();
    }

    // Load all jobs
    function loadAllJobs() {
      const allJobsContainer = document.getElementById('allJobs');
      
      allJobsContainer.innerHTML = '';
      sampleJobs.forEach(job => {
        const jobCard = createJobCard(job);
        allJobsContainer.appendChild(jobCard);
      });
    }

    // Create job card
    function createJobCard(job) {
      const jobCard = document.createElement('div');
      const firstLetter = job.title.charAt(0).toUpperCase();
      const iconClass = getIconClass(job.title);
      
      jobCard.className = 'job-card';
      jobCard.innerHTML = `
        <div class="job-card-header">
          <div class="job-title">
            <div class="job-title-icon ${iconClass}">${firstLetter}</div>
            ${job.title}
          </div>
          <div class="job-actions" onclick="toggleDropdown(${job.id})">
            <span>‚ãÆ</span>
            <div class="dropdown-menu" id="dropdown-${job.id}">
              <a href="#" class="dropdown-item" onclick="viewJob(${job.id})">
                <span>üëÅÔ∏è</span>
                View
              </a>
              <a href="#" class="dropdown-item" onclick="editJob(${job.id})">
                <span>üìù</span>
                Update
              </a>
              <a href="#" class="dropdown-item" onclick="deleteJob(${job.id})">
                <span>üóëÔ∏è</span>
                Delete
              </a>
            </div>
          </div>
        </div>
        <div class="job-company">${job.company}</div>
        <div class="job-location">
          <span>üìç</span>
          ${job.location}
        </div>
        <div class="job-meta">
          <div class="job-date">${job.date}</div>
          <div>
            ${job.status === 'closed' ? '<span class="closed-badge">Closed</span>' : ''}
          </div>
        </div>
      `;
      return jobCard;
    }

    // Get icon class based on job title
    function getIconClass(title) {
      const lowerTitle = title.toLowerCase();
      if (lowerTitle.includes('hcc')) return 'hcc';
      if (lowerTitle.includes('ai')) return 'ai';
      if (lowerTitle.includes('drg')) return 'drg';
      return 'default';
    }

    // Toggle dropdown menu
    function toggleDropdown(jobId) {
      closeAllDropdowns();
      const dropdown = document.getElementById(`dropdown-${jobId}`);
      if (dropdown) {
        dropdown.style.display = 'block';
      }
    }

    // Close all dropdowns
    function closeAllDropdowns() {
      const dropdowns = document.querySelectorAll('.dropdown-menu');
      dropdowns.forEach(dropdown => {
        dropdown.style.display = 'none';
      });
    }

    // View job details
    function viewJob(jobId) {
      event.preventDefault();
      const job = sampleJobs.find(j => j.id === jobId);
      console.log(job,'job');
      if (job) {
        selectedJobId = jobId;
        showJobDetails(job, true); // true indicates view mode
        closeAllDropdowns();
      }
    }

    // Edit job
    function editJob(jobId) {
      event.preventDefault();
      const job = sampleJobs.find(j => j.id === jobId);
      console.log(job,'job');
      if (job) {
        selectedJobId = jobId;
        showJobDetails(job, false); // false indicates edit mode
        closeAllDropdowns();
      }
    }

    // Delete job
    function deleteJob(jobId) {
      event.preventDefault();
      selectedJobId = jobId;
      document.getElementById('deleteModal').style.display = 'block';
      closeAllDropdowns();
    }

    // Initialize Quill Editor
    function initializeQuillEditor() {
      quillEditor = new Quill('#jobDescriptionEditor', {
        theme: 'snow',
        modules: {
          toolbar: [
            [{ 'font': [] }, { 'size': ['small', false, 'large', 'huge'] }],
            ['bold', 'italic', 'underline'],
            ['blockquote', 'code-block'],
            [{ 'header': 1 }, { 'header': 2 }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['link'],
            ['clean']
          ]
        }
      });
    }

    // Show job details panel
    function showJobDetails(job, isViewMode = false) {
      const jobDetailsPanel = document.getElementById('jobDetailsPanel');
      const form = document.getElementById('jobDetailsForm');
      
      // Populate form with job data
      document.getElementById('jobTitle').value = job.title || '';
      document.getElementById('salary').value = job.salary || '';
      document.getElementById('experienceLevel').value = job.experience || '';
      document.getElementById('location').value = job.location || '';
      document.getElementById('jobStatus').value = job.status === 'closed' ? 'false' : 'true';
      
      // Set Quill editor content
      if (quillEditor) {
        console.log(quillEditor,'quillEditor');
        // Convert plain text to Quill format if needed
        const description = job.description || '';
        if (typeof description === 'string') {
          console.log(description,'description string');
          quillEditor.setText(description);
        } else {
          console.log(description,'description object');
          quillEditor.setContents(description);
        }
      }
      
      // Handle view vs edit mode
      if (isViewMode) {
        // View mode - disable all inputs and hide action buttons
        setFormMode(false);
        document.querySelector('.job-details-title').textContent = 'View Job Details';
      } else {
        // Edit mode - enable all inputs and show action buttons
        setFormMode(true);
        document.querySelector('.job-details-title').textContent = 'Edit Job Details';
      }
      
      // Force display and add show class
      jobDetailsPanel.style.display = 'block';
      jobDetailsPanel.style.right = '-400px'; // Start from hidden position
      
      // Use setTimeout to ensure the display change takes effect before animation
      setTimeout(() => {
        jobDetailsPanel.classList.add('show');
        jobDetailsPanel.style.right = '0'; // Animate to visible position
      }, 10);
    }

    // Close job details panel
    function closeJobDetails() {
      const jobDetailsPanel = document.getElementById('jobDetailsPanel');
      
      // Animate out first
      jobDetailsPanel.style.right = '-400px';
      jobDetailsPanel.classList.remove('show');
      
      // Hide after animation
      setTimeout(() => {
        jobDetailsPanel.style.display = 'none';
      }, 300);
    }

    // Set form mode (enabled/disabled)
    function setFormMode(enabled, mode = 'edit') {
      const form = document.getElementById('jobDetailsForm');
      const actionButtons = document.querySelector('.action-buttons');
      const primaryBtn = document.getElementById('primaryActionBtn');
      const secondaryBtn = document.getElementById('secondaryActionBtn');
      
      // Get all form inputs
      const inputs = form.querySelectorAll('input, select, textarea');
      
      inputs.forEach(input => {
        input.disabled = !enabled;
        if (!enabled) {
          input.style.backgroundColor = '#f5f5f5';
          input.style.cursor = 'not-allowed';
        } else {
          input.style.backgroundColor = '';
          input.style.cursor = '';
        }
      });
      
      // Disable/enable Quill editor
      if (quillEditor) {
        quillEditor.enable(enabled);
        const editorContainer = document.querySelector('.quill-editor');
        if (!enabled) {
          editorContainer.style.backgroundColor = '#f5f5f5';
          editorContainer.style.cursor = 'not-allowed';
        } else {
          editorContainer.style.backgroundColor = '';
          editorContainer.style.cursor = '';
        }
      }
      
      // Show/hide action buttons and set button text based on mode
      if (actionButtons) {
        actionButtons.style.display = enabled ? 'flex' : 'none';
        
        if (enabled && primaryBtn && secondaryBtn) {
          if (mode === 'post') {
            // Post new job mode
            primaryBtn.textContent = 'Post';
            primaryBtn.className = 'btn btn-primary';
            secondaryBtn.textContent = 'Cancel';
            secondaryBtn.className = 'btn btn-secondary';
          } else {
            // Edit existing job mode
            primaryBtn.textContent = 'Update Changes';
            primaryBtn.className = 'btn btn-primary';
            secondaryBtn.textContent = 'Cancel';
            secondaryBtn.className = 'btn btn-secondary';
          }
        }
      }
    }

    // Show post job form
    function showPostJobForm() {
      // Clear form and show job details panel
      const form = document.getElementById('jobDetailsForm');
      const jobDetailsPanel = document.getElementById('jobDetailsPanel');
      
      form.reset();
      
      // Set default status to "true" (Open) for new jobs
      document.getElementById('jobStatus').value = 'true';
      
      // Clear Quill editor
      if (quillEditor) {
        quillEditor.setText('');
      }
      
      // Enable form for new job creation
      setFormMode(true, 'post');
      document.querySelector('.job-details-title').textContent = 'Post New Job';
      
      // Force display and add show class
      jobDetailsPanel.style.display = 'block';
      jobDetailsPanel.style.right = '-400px'; // Start from hidden position
      
      // Use setTimeout to ensure the display change takes effect before animation
      setTimeout(() => {
        jobDetailsPanel.classList.add('show');
        jobDetailsPanel.style.right = '0'; // Animate to visible position
      }, 10);
      
      selectedJobId = null;
    }

    // Handle primary action button (Post/Update)
    function handlePrimaryAction() {
      if (selectedJobId === null) {
        // Post new job mode
        postNewJob();
      } else {
        // Update existing job mode
        updateJob();
      }
    }

    // Handle secondary action button (Cancel)
    function handleSecondaryAction() {
      // Both post and edit modes - just cancel/close
      closeJobDetails();
    }

    // Post new job
    function postNewJob() {
      // Validate form
      const jobTitle = document.getElementById('jobTitle').value.trim();
      const location = document.getElementById('location').value.trim();
      const experienceLevel = document.getElementById('experienceLevel').value.trim();
      const salary = document.getElementById('salary').value.trim();
      const jobStatus = document.getElementById('jobStatus').value;
      
      if (!jobTitle || !location || !experienceLevel || !salary || !jobStatus) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      
      // Get Quill editor content
      const jobDescription = quillEditor ? quillEditor.getText().trim() : '';
      
      if (!jobDescription) {
        showToast('Please enter a job description', 'error');
        return;
      }
      
      showToast('New job posted successfully!', 'success');
      closeJobDetails();
    }

    // Update job
    function updateJob() {
      // Validate form
      const jobTitle = document.getElementById('jobTitle').value.trim();
      const location = document.getElementById('location').value.trim();
      const experienceLevel = document.getElementById('experienceLevel').value.trim();
      const salary = document.getElementById('salary').value.trim();
      const jobStatus = document.getElementById('jobStatus').value;
      
      if (!jobTitle || !location || !experienceLevel || !salary || !jobStatus) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      
      // Get Quill editor content
      const jobDescription = quillEditor ? quillEditor.getText().trim() : '';
      
      if (!jobDescription) {
        showToast('Please enter a job description', 'error');
        return;
      }
      
      showToast('Job updated successfully!', 'success');
      closeJobDetails();
    }

    // Confirm delete
    function confirmDelete() {
      if (selectedJobId) {
        showToast('Job deleted successfully!', 'success');
        // Remove job from sample data
        const jobIndex = sampleJobs.findIndex(j => j.id === selectedJobId);
        if (jobIndex > -1) {
          sampleJobs.splice(jobIndex, 1);
          loadJobs(); // Reload jobs
        }
      }
      document.getElementById('deleteModal').style.display = 'none';
      document.getElementById('jobDetailsPanel').style.display = 'none';
      document.getElementById('jobDetailsPanel').classList.remove('show');
      selectedJobId = null;
    }

    // Cancel delete
    function cancelDelete() {
      document.getElementById('deleteModal').style.display = 'none';
      document.getElementById('jobDetailsPanel').style.display = 'none';
      document.getElementById('jobDetailsPanel').classList.remove('show');
      selectedJobId = null;
      showToast('Job deletion cancelled!', 'info');
    }

    // Filter jobs
    function filterJobs(searchTerm) {
      const jobCards = document.querySelectorAll('.job-card');
      const noJobsMessage = document.getElementById('noJobsMessage');
      let visibleJobs = 0;
      
      jobCards.forEach(card => {
        const title = card.querySelector('.job-title').textContent.toLowerCase();
        const company = card.querySelector('.job-company').textContent.toLowerCase();
        const location = card.querySelector('.job-location').textContent.toLowerCase();
        
        if (title.includes(searchTerm) || company.includes(searchTerm) || location.includes(searchTerm)) {
          card.style.display = 'block';
          visibleJobs++;
        } else {
          card.style.display = 'none';
        }
      });
      
      // Show/hide no jobs message
      if (visibleJobs === 0 && searchTerm.length > 0) {
        noJobsMessage.style.display = 'flex';
      } else {
        noJobsMessage.style.display = 'none';
      }
    }

    // Logout function
    function logout() {
      localStorage.removeItem('authToken');
      showToast('Logged out successfully', 'success');
      setTimeout(() => {
        window.location.href = './login.html';
      }, 1000);
    }

    // Show/hide loader
    function showLoader(show) {
      const loader = document.getElementById('loadingSpinner');
      loader.style.display = show ? 'block' : 'none';
    }

    // Show toast notification
    function showToast(message, type = 'success') {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      
      toastContainer.appendChild(toast);
      
      // Show toast
      setTimeout(() => {
        toast.classList.add('show');
      }, 100);
      
      // Remove toast after 5 seconds
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          if (toastContainer.contains(toast)) {
            toastContainer.removeChild(toast);
          }
        }, 300);
      }, 5000);
    }
  </script>
</body>
</html>
